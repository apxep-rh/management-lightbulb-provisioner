---
- debug:
    msg: "{{ result_item['item'][0] }}"
  with_items: "{{ instances.results|groupby('item') }}"
  loop_control:
    loop_var: result_item

- name: Generate student inventories
  template:
    src: instances.txt.j2
    dest: ./{{ item.username }}-instances.txt
  with_items: "{{ users }}"
  tags:
    - inventory
    - users
    - user_accounts

- name: Generate instructor inventory
  template:
    src: instructor_inventory.j2
    dest: ./instructor_inventory.txt
  tags:
    - inventory
    - users
    - user_accounts

- name: Generate html page with student details
  template:
    src: index.html.j2
    dest: ./index.html
  tags:
    - inventory
    - users
    - user_accounts